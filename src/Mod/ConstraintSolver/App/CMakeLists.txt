if(MSVC)
    add_definitions(-DFCAppSketcher -DHAVE_ACOSH -DHAVE_ASINH -DHAVE_ATANH)
else(MSVC)
    add_definitions(-DHAVE_LIMITS_H -DHAVE_CONFIG_H)
endif(MSVC)

include_directories(
    ${CMAKE_BINARY_DIR}
    ${CMAKE_SOURCE_DIR}/src
    ${CMAKE_CURRENT_SOURCE_DIR}
    ${CMAKE_CURRENT_BINARY_DIR}
    ${CMAKE_CURRENT_SOURCE_DIR}/..
    ${CMAKE_CURRENT_BINARY_DIR}/..
    ${Boost_INCLUDE_DIRS}
    ${OCC_INCLUDE_DIR}
    ${ZLIB_INCLUDE_DIR}
    ${PYTHON_INCLUDE_DIRS}
    ${XercesC_INCLUDE_DIRS}
    ${EIGEN3_INCLUDE_DIR}
)

set(ConstraintSolver_LIBS
    FreeCADApp
)

generate_from_xml(ParameterStorePy)
generate_from_xml(ParameterRefPy)
generate_from_xml(ParameterSubsetPy)
generate_from_xml(ValueSetPy)
generate_from_xml(ConstraintPy)
generate_from_xml(SimpleConstraintPy)
generate_from_xml(ParaObjectPy)
generate_from_xml(ParaGeometryPy)
generate_from_xml(SubSystemPy)
generate_from_xml(SolverBackendPy)
generate_from_xml(ConstraintEqualShapePy)

file(MAKE_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}/G2D)
generate_from_xml(G2D/VectorPy)
generate_from_xml(G2D/ParaGeometry2DPy)
generate_from_xml(G2D/ParaVectorPy)
generate_from_xml(G2D/ParaPointPy)
generate_from_xml(G2D/ParaTransformPy)
generate_from_xml(G2D/ParaPlacementPy)
generate_from_xml(G2D/ParaShapePy)
generate_from_xml(G2D/ParaCurvePy)
generate_from_xml(G2D/ParaLinePy)
generate_from_xml(G2D/ParaCirclePy)
generate_from_xml(G2D/ParaConicPy)
generate_from_xml(G2D/ParaEllipsePy)
generate_from_xml(G2D/ParaHyperbolaPy)
generate_from_xml(G2D/ParaParabolaPy)
generate_from_xml(G2D/ParaBSplineBasePy)

generate_from_xml(G2D/ConstraintCurvePosPy)
generate_from_xml(G2D/ConstraintDistancePy)
generate_from_xml(G2D/ConstraintPlacementRulesPy)
generate_from_xml(G2D/ConstraintPointCoincidentPy)
generate_from_xml(G2D/ConstraintPointSymmetryPy)
generate_from_xml(G2D/ConstraintAnglePy)
generate_from_xml(G2D/ConstraintAngleAtXYPy)
generate_from_xml(G2D/ConstraintAngleLineLinePy)
generate_from_xml(G2D/ConstraintDistanceCirclePointPy)
generate_from_xml(G2D/ConstraintDistanceLinePointPy)
generate_from_xml(G2D/ConstraintTangentLineLinePy)
generate_from_xml(G2D/ConstraintTangentCircleLinePy)
generate_from_xml(G2D/ConstraintDirectionalDistancePy)
generate_from_xml(G2D/ConstraintLengthPy)
generate_from_xml(G2D/ConstraintHorizontalPy)
generate_from_xml(G2D/ConstraintPointOnCurvePy)
generate_from_xml(G2D/ConstraintTangentEllipseLinePy)
generate_from_xml(G2D/ConstraintSnellsLawAtXYPy)
generate_from_xml(G2D/ConstraintVerticalPy)
generate_from_xml(G2D/ConstraintTangentCircleCirclePy)
generate_from_xml(G2D/ConstraintEqualLengthPy)

SET(ConstraintSolver_G2D
    G2D/Vector.h
    G2D/Vector.cpp
    G2D/VectorPy.xml
    G2D/VectorPyImp.cpp
    G2D/Position.h
    G2D/Position.cpp
    G2D/Placement.h
    G2D/Placement.cpp
    G2D/ParaGeometry2D.h
    G2D/ParaGeometry2D.cpp
    G2D/ParaGeometry2DPy.xml
    G2D/ParaGeometry2DPyImp.cpp
    G2D/ParaVector.h
    G2D/ParaVector.cpp
    G2D/ParaVectorPy.xml
    G2D/ParaVectorPyImp.cpp
    G2D/ParaPoint.h
    G2D/ParaPoint.cpp
    G2D/ParaPointPy.xml
    G2D/ParaPointPyImp.cpp
    G2D/ParaPlacement.h
    G2D/ParaPlacement.cpp
    G2D/ParaPlacementPy.xml
    G2D/ParaPlacementPyImp.cpp
    G2D/ParaTransform.h
    G2D/ParaTransform.cpp
    G2D/ParaTransformPy.xml
    G2D/ParaTransformPyImp.cpp
    G2D/ParaShape.h
    G2D/ParaShape.cpp
    G2D/ParaShapePy.xml
    G2D/ParaShapePyImp.cpp    
    G2D/ParaCurve.h
    G2D/ParaCurve.cpp
    G2D/ParaCurvePy.xml
    G2D/ParaCurvePyImp.cpp
    G2D/ParaLine.h
    G2D/ParaLine.cpp
    G2D/ParaLinePy.xml
    G2D/ParaLinePyImp.cpp
    G2D/ParaCircle.h
    G2D/ParaCircle.cpp
    G2D/ParaCirclePy.xml
    G2D/ParaCirclePyImp.cpp
    G2D/ParaConic.h
    G2D/ParaConic.cpp
    G2D/ParaConicPy.xml
    G2D/ParaConicPyImp.cpp
    G2D/ParaEllipse.h
    G2D/ParaEllipse.cpp
    G2D/ParaEllipsePy.xml
    G2D/ParaEllipsePyImp.cpp
    G2D/ParaHyperbola.h
    G2D/ParaHyperbola.cpp
    G2D/ParaHyperbolaPy.xml
    G2D/ParaHyperbolaPyImp.cpp
    G2D/ParaParabola.h
    G2D/ParaParabola.cpp
    G2D/ParaParabolaPy.xml
    G2D/ParaParabolaPyImp.cpp
    G2D/ParaBSplineBase.h
    G2D/ParaBSplineBase.cpp
    G2D/ParaBSplineBasePy.xml
    G2D/ParaBSplineBasePyImp.cpp
    G2D/ConstraintCurvePos.h
    G2D/ConstraintCurvePos.cpp
    G2D/ConstraintCurvePosPy.xml
    G2D/ConstraintCurvePosPyImp.cpp
    G2D/ConstraintDistance.h
    G2D/ConstraintDistance.cpp
    G2D/ConstraintDistancePy.xml
    G2D/ConstraintDistancePyImp.cpp
    G2D/ConstraintPlacementRules.h
    G2D/ConstraintPlacementRules.cpp
    G2D/ConstraintPlacementRulesPy.xml
    G2D/ConstraintPlacementRulesPyImp.cpp
    G2D/ConstraintPointSymmetry.cpp
    G2D/ConstraintPointSymmetry.h
    G2D/ConstraintPointSymmetryPy.xml
    G2D/ConstraintPointSymmetryPyImp.cpp
    G2D/ConstraintPointCoincident.cpp
    G2D/ConstraintPointCoincident.h
    G2D/ConstraintPointCoincidentPy.xml
    G2D/ConstraintPointCoincidentPyImp.cpp
    G2D/ConstraintAngle.cpp
    G2D/ConstraintAngle.h
    G2D/ConstraintAnglePy.xml
    G2D/ConstraintAnglePyImp.cpp
    G2D/ConstraintAngleAtXY.cpp
    G2D/ConstraintAngleAtXY.h
    G2D/ConstraintAngleAtXYPy.xml
    G2D/ConstraintAngleAtXYPyImp.cpp
    G2D/ConstraintAngleLineLine.cpp
    G2D/ConstraintAngleLineLine.h
    G2D/ConstraintAngleLineLinePy.xml
    G2D/ConstraintAngleLineLinePyImp.cpp
    G2D/ConstraintDistanceCirclePoint.cpp
    G2D/ConstraintDistanceCirclePoint.h
    G2D/ConstraintDistanceCirclePointPy.xml
    G2D/ConstraintDistanceCirclePointPyImp.cpp
    G2D/ConstraintDistanceLinePoint.cpp
    G2D/ConstraintDistanceLinePoint.h
    G2D/ConstraintDistanceLinePointPy.xml
    G2D/ConstraintDistanceLinePointPyImp.cpp
    G2D/ConstraintTangentLineLine.cpp
    G2D/ConstraintTangentLineLine.h
    G2D/ConstraintTangentLineLinePy.xml
    G2D/ConstraintTangentLineLinePyImp.cpp
    G2D/ConstraintTangentCircleLine.cpp
    G2D/ConstraintTangentCircleLine.h
    G2D/ConstraintTangentCircleLinePy.xml
    G2D/ConstraintTangentCircleLinePyImp.cpp
    G2D/ConstraintDirectionalDistance.cpp
    G2D/ConstraintDirectionalDistance.h
    G2D/ConstraintDirectionalDistancePy.xml
    G2D/ConstraintDirectionalDistancePyImp.cpp
    G2D/ConstraintLength.cpp
    G2D/ConstraintLength.h
    G2D/ConstraintLengthPy.xml
    G2D/ConstraintLengthPyImp.cpp
    G2D/ConstraintHorizontal.cpp
    G2D/ConstraintHorizontal.h
    G2D/ConstraintHorizontalPy.xml
    G2D/ConstraintHorizontalPyImp.cpp
    G2D/ConstraintPointOnCurve.cpp
    G2D/ConstraintPointOnCurve.h
    G2D/ConstraintPointOnCurvePy.xml
    G2D/ConstraintPointOnCurvePyImp.cpp
    G2D/ConstraintTangentEllipseLine.cpp
    G2D/ConstraintTangentEllipseLine.h
    G2D/ConstraintTangentEllipseLinePy.xml
    G2D/ConstraintTangentEllipseLinePyImp.cpp
    G2D/ConstraintSnellsLawAtXY.cpp
    G2D/ConstraintSnellsLawAtXY.h
    G2D/ConstraintSnellsLawAtXYPy.xml
    G2D/ConstraintSnellsLawAtXYPyImp.cpp
    G2D/ConstraintVertical.cpp
    G2D/ConstraintVertical.h
    G2D/ConstraintVerticalPy.xml
    G2D/ConstraintVerticalPyImp.cpp
    G2D/ConstraintTangentCircleCircle.cpp
    G2D/ConstraintTangentCircleCircle.h
    G2D/ConstraintTangentCircleCirclePy.xml
    G2D/ConstraintTangentCircleCirclePyImp.cpp
    G2D/ConstraintEqualLength.cpp
    G2D/ConstraintEqualLength.h
    G2D/ConstraintEqualLengthPy.xml
    G2D/ConstraintEqualLengthPyImp.cpp
    G2D/ConstraintEllipseRules.h
    G2D/ConstraintEllipseRules.cpp
    G2D/ConstraintHyperbolaRules.h
    G2D/ConstraintHyperbolaRules.cpp
)

SET(ConstraintSolver_Utils_SRCS
    Utils.h
    Utils.cpp
    PyUtils.h
    PyUtils.cpp
    DualMath.h
    DualMath.cpp
)

SET(Python_Solver_SRCS
    ParameterStorePy.xml
    ParameterStorePyImp.cpp
    ParameterRefPy.xml
    ParameterRefPyImp.cpp
    ParameterSubsetPy.xml
    ParameterSubsetPyImp.cpp
    ValueSetPy.xml
    ValueSetPyImp.cpp
    ConstraintPy.xml
    ConstraintPyImp.cpp
    SimpleConstraintPy.xml
    SimpleConstraintPyImp.cpp
    ParaObjectPy.xml
    ParaObjectPyImp.cpp
    ParaGeometryPy.xml
    ParaGeometryPyImp.cpp
    SubSystemPy.xml
    SubSystemPyImp.cpp
    SolverBackendPy.xml
    SolverBackendPyImp.cpp
    ConstraintEqualShapePy.xml
    ConstraintEqualShapePyImp.cpp
)

SET(ConstraintSolver_Solver_SRCS
    Parameter.h
    Parameter.cpp
    ParameterRef.h
    ParameterRef.cpp
    ParameterStore.h
    ParameterStore.cpp
    ParameterSubset.h
    ParameterSubset.cpp
    ValueSet.h
    ValueSet.cpp
    Constraint.h
    Constraint.cpp
    SimpleConstraint.h
    SimpleConstraint.cpp
    ParaObject.h
    ParaObject.cpp
    ParaGeometry.h
    ParaGeometry.cpp
    SubSystem.h
    SubSystem.cpp
    SolverBackend.h
    SolverBackend.cpp
    DogLeg.h
    DogLeg.cpp
    LM.h
    LM.cpp
    BFGS.h
    BFGS.cpp
    SQP.h
    SQP.cpp
    ConstraintEqualShape.h
    ConstraintEqualShape.cpp
)

SET(ConstraintSolver_Module_SRCS
    AppConstraintSolver.cpp
    PreCompiled.cpp
    PreCompiled.h    
)

SET(ConstraintSolver_SRCS
    ${ConstraintSolver_Utils_SRCS}
    ${ConstraintSolver_Solver_SRCS}
    ${Python_Solver_SRCS}
    ${ConstraintSolver_Module_SRCS}
    ${ConstraintSolver_G2D}
)

add_library(ConstraintSolver SHARED ${ConstraintSolver_SRCS})
target_link_libraries(ConstraintSolver ${ConstraintSolver_LIBS})


SET_BIN_DIR(ConstraintSolver ConstraintSolver /Mod/ConstraintSolver)
SET_PYTHON_PREFIX_SUFFIX(ConstraintSolver)

install(TARGETS ConstraintSolver DESTINATION ${CMAKE_INSTALL_LIBDIR})
